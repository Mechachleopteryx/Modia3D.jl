<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Collision Handling · Modia3D</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Modia3D</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../index.html">Home</a></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="GettingStarted.html">Getting Started</a></li><li><a class="toctext" href="Examples.html">Examples</a></li><li><a class="toctext" href="Materials.html">Materials</a></li><li class="current"><a class="toctext" href="CollisionHandling.html">Collision Handling</a><ul class="internal"><li><a class="toctext" href="#Material-constants-1">Material constants</a></li><li><a class="toctext" href="#Response-calculation-1">Response calculation</a></li><li><a class="toctext" href="#Regularized-unit-vectors-1">Regularized unit vectors</a></li><li><a class="toctext" href="#Damping-coefficient-1">Damping coefficient</a></li><li><a class="toctext" href="#Literature-1">Literature</a></li></ul></li><li><a class="toctext" href="Plans.html">Plans</a></li></ul></li><li><span class="toctext">Library</span><ul><li><a class="toctext" href="../lib/Composition.html">Composition</a></li><li><a class="toctext" href="../lib/Graphics.html">Graphics</a></li><li><a class="toctext" href="../lib/Solids.html">Solids</a></li><li><a class="toctext" href="../lib/ForceElements.html">ForceElements</a></li><li><a class="toctext" href="../lib/Basics.html">Basics</a></li></ul></li><li><span class="toctext">Internal</span><ul><li><a class="toctext" href="../internal/ContactDetection.html">Contact Detection</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Manual</li><li><a href="CollisionHandling.html">Collision Handling</a></li></ul><a class="edit-page" href="https://github.com//blob/master/docs/src/man/CollisionHandling.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Collision Handling</span><a class="fa fa-bars" href="#"></a></div></header><p>﻿</p><h1><a class="nav-anchor" id="Collision-Handling-1" href="#Collision-Handling-1">Collision Handling</a></h1><p>Modia3D supports collisions of objects that are defined with a contact material and (a) have a convex geometry, or (b) can be approximated by a set of convex geometries, or (c) have a concave geometry that is (automatically) approximated by its convex hull. When contact occurs, the response is computed with elastic force/torque laws based on the penetration depth and the relative motion of the objects in contact. It is planned to optionally also support impulsive response calculation in the future.</p><p>The current approach has several <strong>limitations</strong> that a user must know, in order that a simulation is successful:</p><ul><li>The current collision handling is designed for variable step-size integrators for systems that have realistic physical material behaviour.</li></ul><ul><li>Usually, a relative tolerance of <span>$10^{-8}$</span> or smaller has to be used since otherwise a variable step-size integrator will typically fail. The reason is that the penetration depth is computed from the difference of tolerance-controlled variables and the precision will be not sufficient if a higher tolerance will be used because the penetration depth is in the order of <span>$10^{-5} .. 10^{-6}~ m$</span>. A relative tolerancie of <span>$10^{-5}$</span> might be used, if the heuristic elastic contact reduction factor  <span>$k_{red} = 10^{4}$</span> (see below).</li></ul><ul><li>A reasonable reliable simulation requires that objects have only <em>point contact</em>, since otherwise the contact point can easily <span>$jump$</span> between model evaluations and a variable step-size integrator will not be able to cope with this, so will terminate with an error. For this reason, all geometrical objects are slightly modified in various ways for the collision handling. Most important, all geometries are <em>smoothed</em> with a small sphere (e.g. with radius = 1mm) that is moved over all surfaces.</li></ul><h2><a class="nav-anchor" id="Material-constants-1" href="#Material-constants-1">Material constants</a></h2><p>The response calculation uses the following material constants from the <a href="Materials.html#Solid-material-1">Solid material</a> palette and from the <a href="Materials.html#Contact-pair-material-1">Contact pair material</a> palette.</p><ul><li><code>E</code> in [N/m^2]: Young&#39;s modulus of contact material (<span>$\gt 0$</span>).</li><li><code>nu</code>: Poisson&#39;s ratio of contact material (<span>$0 \lt nu \lt 1$</span>).</li><li><code>cor</code>: Coefficient of restitution between <em>two objects</em> (<span>$0 \le cor \le 1$</span>).</li><li><code>mu_k</code>: Kinetic/sliding friction force coefficient between <em>two objects</em> (<span>$\ge 0$</span>).</li><li><code>mu_r</code>: Rotational rolling resistance torque coefficient between <em>two objects</em> (<span>$\ge 0$</span>).</li></ul><p>Additionally, the response calculation is changed at small relative velocities and relative angular velocities. This region is defined by the following constants:</p><ul><li><code>vsmall</code> in [m/s]: Used for regularization when computing the unit vector in direction of                    the relative tangential velocity (see below).</li><li><code>wsmall</code> in [rad/s]: Used for regularization when computing the unit vector in direction of                      the relative angular velocity (see below).</li></ul><p>Finally, the heuristic factor <span>$k_{red}$</span> (default = 1.0) can be defined with keyword argument <code>elasticContactReductionFactor</code> in the <code>SceneOptions</code> constructor. The goals is the following:  Applying the elastic response calculation on hard materials  such as steel, typically results in penetration depths in the order of  <span>$10^{-5} .. 10^{-5} m$</span>. A penetration depth is implicitly computed by the  difference of the absolute positions of the objects in contact and  these absolute positions are typically error-controlled variables of  the integrator. This in turn means that typically at least a relative  tolerance of <span>$10^{-8}$</span> needs to be used for the integration, in order that  the penetration depth is computed with 2 or 3 significant digits.  To improve simulation speed, factor <span>$k_{red}$</span>  reduces the stiffness of the contact and therefore enlarges the  penetration depth. If <span>$k_{red}$</span> is for example set to <span>$10^{4}$</span>, the penetration  depth might be in the order of <span>$10^{-3} m$</span> and then a relative tolerance  of <span>$10^{-5}$</span> might be sufficient. In many cases, the essential response  characteristic is not changed (just the penetration depth is larger),  but simulation speed is significantly improved.</p><h2><a class="nav-anchor" id="Response-calculation-1" href="#Response-calculation-1">Response calculation</a></h2><p>When two 3D objects penetrate each other with a penetration depth <span>$\delta &gt; 0$</span> then a <em>contact force</em> and a <em>contact torque</em> is computed from the elastic contact materials of the two objects in the following way (the contact force law in normal direction is based on <a href="#footnote-1">[1]</a>, <a href="#footnote-3">[3]</a>, the remaining force law on <a href="#footnote-2">[2]</a> with some extensions and corrections):</p><div>\[\begin{align}
f_n        &amp;= k_{red} \max\left(0, c_{res} \cdot c_{geo} \cdot \delta^{n_{geo}} \cdot (1 + d \cdot \dot{\delta}) \right) \\
\vec{f}_n &amp;= f_n \cdot \vec{e}_n \\
\vec{f}_t &amp;= -\mu_{k} \cdot f_n \cdot \vec{e}_{t,reg} \\
\vec{\tau} &amp;= -\mu_{r} \cdot \mu_{r,geo}  \cdot f_n \cdot \vec{e}_{\omega,reg}
\end{align}\]</div><p>where</p><ul><li><span>$\vec{e}_n$</span>: Unit vector perpendicular to the surface of object 1 at the contact point, pointing outwards.</li><li><span>$\vec{e}_{t,reg}$</span>: Regularized unit vector in direction of the tangential relative velocity (see below).</li><li><span>$\vec{e}_{\omega,reg}$</span>: Regularized unit vector in direction of the relative angular velocity (see below).</li><li><span>$f_n$</span>: Value of normal contact force in direction of <span>$\vec{e}_n$</span> acting on object 2 (<span>$f_n \ge 0$</span>).</li><li><span>$\vec{f}_n$</span>: Vector of normal contact force acting on object 2.</li><li><span>$\vec{f}_t$</span>: Vector of sliding friction force acting on object 2 in opposite direction of the movement                 in the tangential plane of the contact.</li><li><span>$\vec{\tau}$</span>: Vector of rolling resistance torque acting on object 2, in opposite direction to the                   relative angular velocity between the two contacting objects.</li><li><span>$\delta$</span>: Signed distance between object 1 and 2 in normal direction <span>$\vec{e}_n$</span>.              <span>$\delta &gt; 0$</span> if objects are penetrating each other.</li><li><span>$\dot{\delta}$</span>: Signed relative velocity between object 1 and 2 in normal direction <span>$\vec{e}_n$</span>.</li><li><span>$c_{res}$</span>: Resultant elastic material constant in normal direction. This constant is computed        from the constants <span>$c_1, c_2$</span> of the two contacting objects 1 and 2 as        <span>$c_{res} = 1/\left( 1/c_1 + 1/c_2 \right)$</span>. <span>$c_i$</span> is computed from the material properties as        <span>$c_i = E_i/(1 - \nu_i^2)$</span> where <span>$E_i$</span> is Young&#39;s modules and        <span>$\nu_i$</span> is Poisson&#39;s ratio of object i.</li><li><span>$c_{geo}$</span>: Factor in <span>$f_n$</span> that is determined from the geometries of the              two objects (see below).</li><li><span>$n_{geo}$</span>: Exponent in <span>$f_n$</span> that is determined from the geometries of the              two objects (see below).</li><li><span>$d(cor_{reg},\dot{\delta}^-)$</span>: Damping coefficient in normal direction as a function of        <span>$cor_{reg}$</span> and <span>$\dot{\delta}^-$</span> (see below).</li><li><span>$cor_{reg}$</span>: Regularized coefficient of restitution between objects 1 and 2, see below.</li><li><span>$\dot{\delta}^-$</span>: Value of <span>$\dot{\delta}$</span> when contact starts (<span>$\dot{\delta}^- \ge 0$</span>).</li><li><span>$\mu_k$</span>: Kinetic/sliding friction force coefficient between objects 1 and 2.</li><li><span>$\mu_r$</span>: Rotational rolling resistance torque coefficient between objects 1 and 2.</li><li><span>$\mu_{r,geo}$</span>: Factor in <span>$\vec{\tau}$</span> that is determined from the geometries of the                   two objects (see below).</li><li><span>$k_{red}$</span>: Elastic contact reduction factor.</li></ul><p>The <span>$\max(..)$</span> operator in equation (1) is provided, in order to guarantee that <span>$f_n$</span> is always a compressive and never a pulling force because this would be unphysical.</p><p>In special cases (for example sphere rolling on a plane), the rotational coefficient of friction <span>$\mu_{r,res}$</span> can be interpreted as <em>rolling resistance coefficient</em>.</p><p>Coefficients <span>$c_{geo}, n_{geo}, \mu_{r,geo}$</span> depend on the geometries of the objects that are in contact. Only for spheres meaning values are provided based on Hertz&#39; pressure, because currently the collision handling in Modia3D does no provide enough information for other geometries (<span>$r_i$</span> is the radius of sphere <span>$i$</span>):</p><table><tr><th style="text-align: left">Object 1</th><th style="text-align: left">Object 2</th><th style="text-align: left"><span>$c_{geo}$</span></th><th style="text-align: left"><span>$n_{geo}$</span></th><th style="text-align: left"><span>$\mu_{r,geo}$</span></th></tr><tr><td style="text-align: left">Sphere</td><td style="text-align: left">Sphere</td><td style="text-align: left"><span>$\frac{4}{3} \sqrt{1/(1/r_1+1/r_2)}$</span></td><td style="text-align: left"><span>$1.5$</span></td><td style="text-align: left"><span>$1/(1/r_1+1/r_2)$</span></td></tr><tr><td style="text-align: left">Sphere</td><td style="text-align: left">no Sphere</td><td style="text-align: left"><span>$\frac{4}{3} \sqrt{r_1}$</span></td><td style="text-align: left"><span>$1.5$</span></td><td style="text-align: left"><span>$r_1$</span></td></tr><tr><td style="text-align: left">no Sphere</td><td style="text-align: left">no Sphere</td><td style="text-align: left"><span>$1$</span></td><td style="text-align: left"><span>$1.0$</span></td><td style="text-align: left"><span>$1.0$</span></td></tr></table><h2><a class="nav-anchor" id="Regularized-unit-vectors-1" href="#Regularized-unit-vectors-1">Regularized unit vectors</a></h2><p>The unit vectors <span>$\vec{e}_t, \vec{e}_{\omega}$</span> are undefined if the relative velocity and/or the relative angular velocity vanish. They are therefore approximately calculated using utility function <span>$reg(v_{abs}, v_{small})$</span>. This function returns <span>$v_{abs}$</span> if <span>$v_{abs} \ge v_{small}$</span> and otherwise returns a third order polynomial with a minimum of <span>$v_{small}/3$</span> at <span>$v_{abs}=0$</span> and smooth first and second derivatives at <span>$v_{abs} = v_{small}$</span>):</p><div>\[reg(v_{abs}, v_{small}) = \text{if}~ v_{abs} \ge v_{small} ~\text{then}~ v_{abs} ~\text{else}~
                          \frac{v_{abs}^2}{v_{small}}
                          \left( 1 - \frac{v_{abs}}{3v_{small}} \right) + \frac{v_{small}}{3}\]</div><p>Example for <span>$v_{small} = 0.1$</span>:</p><p><img src="../../resources/images/plot_reg.svg" alt="Regularization function"/></p><p>With <span>$\vec{v}_i$</span> the absolute velocity of the contact point of object <span>$i$</span>, and <span>$\vec{\omega}_i$</span> the absolute angular velocity of object <span>$i$</span>, the regularized unit vectors are calculated with function <span>$reg(...)$</span> in the following way:</p><div>\[\begin{align}
\vec{e}_{t,reg}       =&amp; \frac{\vec{v}_{rel,t}}{reg(|\vec{v}_{rel,t}|, v_{small})}; \quad
                          \vec{v}_{rel} = \vec{v}_2 - \vec{v}_1; \;
                          \vec{v}_{rel,t} = \vec{v}_{rel}  - (\vec{v}_{rel} \cdot \vec{e}_n) \vec{e}_n \\
\vec{e}_{\omega,reg} =&amp; \frac{\vec{\omega}_{rel}}{reg(|\vec{\omega}_{rel}|,\omega_{small})}; \quad
                          \vec{\omega}_{rel} = \vec{\omega}_2 - \vec{\omega}_1
\end{align}\]</div><p>The effect is that the absolute value of a regularized unit vector is approximated by the following smooth characteristics (and therefore the corresponding friction force and contact torque have a similar characteristic)</p><p><img src="../../resources/images/plot_friction1.svg" alt="Sliding friction force"/></p><h2><a class="nav-anchor" id="Damping-coefficient-1" href="#Damping-coefficient-1">Damping coefficient</a></h2><p>There are several proposal to compute the damping coefficient as a function of the coefficient of restitution <span>$cor$</span> and the velocity when contact starts <span>$\dot{\delta}^-$</span>. For a comparision of the different formulations see <a href="#footnote-1">[1]</a>, <a href="#footnote-3">[3]</a>.</p><p>Whenever the coefficient of restitution <span>$cor &gt; 0$</span>, then an object 2 jumping on an object 1 will mathematically never come to rest, although this is unphysical. To fix this, the value of a coefficient of restitution is reduced when the velocity at contact start becomes small. Furthermore, the coefficient of restitution is restricted to not become smaller as a minimum value <span>$cor_{min} = 0.001$</span> in order to avoid a division by zero when computing the damping coefficient. The following regularization function is used:</p><div>\[cor_{reg} = cor_{lim} + (cor_{min} - cor_{lim}) \cdot e^{log(0.01) |\dot{\delta}^-|/v_{small}}; \;\;
            cor_{lim} = \max(cor_{min}, cor)\]</div><p>Examples of this characteristics are shown in the next figure:</p><p><img src="../../resources/images/plot_cor.svg" alt="Regularized coefficient of restitution"/></p><p>The damping coefficient <span>$d$</span> is basically computed with the formulation from <a href="#footnote-1">[1]</a> because a response calculation with impulses gives similar results for some experiments as shown in <a href="#footnote-3">[3]</a>. However, (a) instead of the coefficient of restitution, the regularized form from above is used, (b) <span>$|\dot{\delta}^-|$</span> is regularized to avoid a division by zero, and (c) the damping coefficient is limited to <span>$d_{max} = 1000$</span> to avoid an unphysical strong creeping effect for collisions with small <span>$cor_{reg}$</span> values:</p><div>\[d(cor_{reg},\dot{\delta}^-) = \min(1000, \frac{8(1-cor_{reg})}{\left(5 \cdot cor_{reg} \cdot reg(|\dot{\delta}^-|, v_{small}) \right)})\]</div><p>Examples of this characteristics are shown in the next two figures:</p><p><img src="../../resources/images/plot_damping1.svg" alt="Damping coefficient 1"/></p><p><img src="../../resources/images/plot_damping2.svg" alt="Damping coefficient 2"/></p><p>In the next figure the simulation of a bouncing ball is shown where the response calculation is performed (a) with an impulse and (b) with the compliant force law above. In both cases the regularized coefficient of restitution <span>$cor_{reg}$</span> is going to zero when <span>$|\dot{\delta}^-|$</span> becomes small. As can be seen, both formulations lead to similar responses:</p><p><img src="../../resources/images/plot_bouncingBall.svg" alt="Bouncing ball"/></p><h2><a class="nav-anchor" id="Literature-1" href="#Literature-1">Literature</a></h2><div class="footnote" id="footnote-1"><a href="#footnote-1"><strong>[1]</strong></a><p>Paulo Flores, Margarida Machado, Miguel Silva, Jorge Martins (2011):   <a href="https://hal.archives-ouvertes.fr/hal-01333699">On the continuous contact force models for soft materials in   multibody dynamics</a>.   Multibody System Dynamics, Springer Verlag,   Vol. 25, pp. 357-375. 10.1007/s11044-010-9237-4.</p></div><div class="footnote" id="footnote-2"><a href="#footnote-2"><strong>[2]</strong></a><p>Martin Otter, Hilding Elmqvist, José Díaz López (2005):   <a href="https://modelica.org/events/Conference2005/online_proceedings/Session1/Session1a4.pdf">Collision Handling for the Modelica MultiBody Library</a>.   Proceedings of the 4th International Modelica Conference 2005,   Gerhard Schmitz (Ed.), pages 45-53.</p></div><div class="footnote" id="footnote-3"><a href="#footnote-3"><strong>[3]</strong></a><p>Luka Skrinjar, Janko Slavic, Miha Boltezar (2018):   <a href="https://doi.org/10.1016/j.ijmecsci.2018.07.010">A review of continuous contact-force models in multibody dynamics</a>.   International Journal of Mechanical Sciences, Volume 145,   Sept., pages 171-187.</p></div><footer><hr/><a class="previous" href="Materials.html"><span class="direction">Previous</span><span class="title">Materials</span></a><a class="next" href="Plans.html"><span class="direction">Next</span><span class="title">Plans</span></a></footer></article></body></html>
